plugin:
  flux-trace:
    shortCut: z
    description: Flux trace
    scopes:
      - all
    command: bash
    background: false
    confirm: false
    args:
      - -c
      - "flux trace --context $CONTEXT $NAME --kind `echo $RESOURCE_NAME | sed -E 's/(s|es)$//g'` --api-version $RESOURCE_GROUP/$RESOURCE_VERSION --namespace $NAMESPACE $NAME |& less"
  get-all:
    shortCut: x
    description: Get all
    scopes:
      - all
    command: bash
    background: false
    confirm: false
    args:
      - -c
      - "kubectl get-all --context $CONTEXT -n $NAMESPACE |& less"
  get-suspended-helmreleases:
    shortCut: Shift-S
    description: List suspended
    scopes:
      - helmrelease
    command: bash
    background: false
    confirm: false
    args:
      - -c
      - "kubectl get helmreleases.helm.toolkit.fluxcd.io --all-namespaces --context $CONTEXT -o json | jq -r '.items[] | select(.spec.suspend==true) | [.metadata.namespace,.metadata.name,.spec.suspend] | @tsv' |& less"
  get-suspended-kustomizations:
    shortCut: Shift-S
    description: List suspended
    scopes:
      - kustomizations
    command: bash
    background: false
    confirm: false
    args:
      - -c
      - "kubectl get kustomizations.kustomize.toolkit.fluxcd.io --all-namespaces --context $CONTEXT -o json | jq -r '.items[] | select(.spec.suspend==true) | [.metadata.name,.spec.suspend] | @tsv' |& less"
  kapp-inspect:
    shortCut: Shift-Z
    description: Kapp inspect
    scopes:
      - app
    command: bash
    background: false
    confirm: false
    args:
      - -c
      - "export FORCE_COLOR=1;kapp inspect -a $NAME.app --namespace $NAMESPACE --color --tty |& less -R"
  kctrl-app-status:
    shortCut: Shift-Q
    description: kctrl app status
    scopes:
      - app
    command: bash
    background: false
    confirm: false
    args:
      - -c
      - "export FORCE_COLOR=1;kctrl app status -a $NAME --namespace $NAMESPACE --color --tty |& less -R"
  kctrl-app-pause:
    shortCut: Shift-T
    description: kctrl app pause
    scopes:
      - app
    command: bash
    background: false
    confirm: false
    args:
      - -c
      - "export FORCE_COLOR=1;kctrl app pause -a $NAME --namespace $NAMESPACE --yes --color --tty |& less -R"
  kctrl-app-kick:
    shortCut: Shift-Z
    description: kctrl app kick
    scopes:
      - app
    command: bash
    background: false
    confirm: false
    args:
      - -c
      - "export FORCE_COLOR=1;kctrl app kick -a $NAME --namespace $NAMESPACE --yes --color --tty |& less -R"
  toggle-helmrelease:
    shortCut: Shift-T
    description: Toggle suspend/resume
    scopes:
      - helmreleases
    command: bash
    background: false
    confirm: true
    args:
      - -c
      - "flux $([ $(kubectl get helmreleases --context $CONTEXT -n $NAMESPACE $NAME -o=custom-columns=TYPE:.spec.suspend | tail -1) = \"true\" ] && echo \"resume\" || echo \"suspend\") helmrelease --context $CONTEXT -n $NAMESPACE $NAME |& less"
  toggle-kustomization:
    shortCut: Shift-T
    description: Toggle suspend/resume
    scopes:
      - kustomizations
    command: bash
    background: false
    confirm: true
    args:
      - -c
      - "flux $([ $(kubectl get kustomizations --context $CONTEXT -n $NAMESPACE $NAME -o=custom-columns=TYPE:.spec.suspend | tail -1) = \"true\" ] && echo \"resume\" || echo \"suspend\") kustomization --context $CONTEXT -n $NAMESPACE $NAME |& less"
  toggle-sources:
    shortCut: Shift-T
    scopes:
      - gitrepo
    description: Toggle suspend/resume
    command: bash
    background: false
    confirm: true
    args:
      - -c
      - "flux --context $CONTEXT $([ $(kubectl --context $CONTEXT get gitrepo -n $NAMESPACE $NAME -o=custom-columns=TYPE:.spec.suspend | tail -1) = \"true\" ] && echo \"resume\" || echo \"suspend\") source git -n $NAMESPACE $NAME |& less"
  toggle-kustomization-tf:
    shortCut: Shift-T
    scopes:
      - terraform
    description: Toggle suspend/resume
    command: sh
    background: false
    confirm: true
    args:
      - -c
      - "tfctl $([ $(kubectl get terraforms.infra.contrib.fluxcd.io -n $NAMESPACE $NAME -o=custom-columns=TYPE:.spec.suspend | tail -1) = \"true\" ] && echo \"resume\" || echo \"suspend\") --context $CONTEXT -n $NAMESPACE $NAME | less"
  reconcile-git:
    shortCut: Shift-Z
    description: Flux reconcile
    scopes:
      - gitrepositories
    command: bash
    background: false
    confirm: false
    args:
      - -c
      - "flux reconcile source git --context $CONTEXT -n $NAMESPACE $NAME |& less"
  reconcile-tf:
    shortCut: Shift-Z
    description: Flux reconcile
    scopes:
      - terraform
    command: sh
    background: false
    confirm: false
    args:
      - -c
      - "tfctl reconcile $NAME --context $CONTEXT -n $NAMESPACE | less"
  reconcile-hr:
    shortCut: Shift-Z
    description: Flux reconcile
    scopes:
      - helmreleases
    command: bash
    background: false
    confirm: false
    args:
      - -c
      - "flux reconcile helmrelease --context $CONTEXT -n $NAMESPACE $NAME |& less"
  reconcile-ks:
    shortCut: Shift-Z
    description: Flux reconcile
    scopes:
      - kustomizations
    command: bash
    background: false
    confirm: false
    args:
      - -c
      - "flux reconcile kustomization --context $CONTEXT -n $NAMESPACE $NAME |& less"
  submit-argo-workflow-template:
    shortCut: t
    description: Submit argo workflow
    scopes:
      - workflowtemplates
    command: bash
    background: false
    confirm: true
    args:
      - -c
      - "argo submit --from workflowtemplate/$NAME -n $NAMESPACE |& less"
  debug:
    shortCut: Shift-D
    description: Add debug container
    scopes:
      - containers
    command: bash
    background: false
    confirm: true
    args:
      - -c
      - "kubectl debug -it -n=$NAMESPACE $POD --target=$NAME --image=rancherlabs/swiss-army-knife:2 --share-processes -- bash"
